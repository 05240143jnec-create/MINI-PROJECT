<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Online Cleaning Service</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #333333;
            background-image: url(../image/JNEC-Campus.jpg);
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        .sidebar {
            background-color: #2c3e50;
            border-right: 1px solid #34495e;
        }
        .sidebar a {
            color: #ecf0f1;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .sidebar a.active {
            background-color: #3498db;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .sidebar a:hover {
            background-color: rgba(52, 73, 94, 0.7);
            transform: translateX(5px);
        }
        .header {
            background-color: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid #E5E7EB;
        }
        .content-panel {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #000000;
            font-weight: 600;
            
        }
        .table-header {
            background-color: #3498db;
            color: white;
        }
        .page-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .booking-tab.active {
            border-bottom-color: #3498db;
            color: #3498db;
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.9) 0%, rgba(245, 87, 108, 0.9) 100%);
        }
        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.9) 0%, rgba(0, 242, 254, 0.9) 100%);
        }
        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, rgba(67, 233, 123, 0.9) 0%, rgba(56, 249, 215, 0.9) 100%);
        }
        .table-row {
            transition: all 0.2s ease;
        }
        .table-row:hover {
            background-color: rgba(249, 250, 251, 0.8);
            transform: translateY(-2px);
        }
        .logo-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            padding: 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .import-modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
        /* New improvements */
        .notification-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .smooth-transition {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #3498db;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="text-dark-1000">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 sidebar flex-shrink-0">
            <div class="flex items-center justify-start h-20 px-6">
                 <h1 class="text-xl font-bold text-white flex items-center">
                    <div class="logo-container">
                         <img src="../image/logo.jpg" alt="Cleaning Service Logo" class="h-12 w-12 rounded-full">
                    </div>
                    <span class="ml-3">Admin</span>
                 </h1>
            </div>
            <nav class="flex-1 px-4 py-2 space-y-2">
                <a data-page="dashboard" class="nav-link active flex items-center px-4 py-3 rounded-lg">
                    <i data-lucide="layout-dashboard" class="h-5 w-5"></i><span class="ml-3">Dashboard</span>
                </a>
                <a data-page="users" class="nav-link flex items-center px-4 py-3 rounded-lg">
                    <i data-lucide="users" class="h-5 w-5"></i><span class="ml-3">Users</span>
                </a>
                <a data-page="bookings" class="nav-link flex items-center px-4 py-3 rounded-lg">
                    <i data-lucide="calendar-check" class="h-5 w-5"></i><span class="ml-3">Bookings</span>
                </a>
                <a data-page="payments" class="nav-link flex items-center px-4 py-3 rounded-lg">
                    <i data-lucide="credit-card" class="h-5 w-5"></i><span class="ml-3">Payments</span>
                </a>
                <a data-page="cleaners" class="nav-link flex items-center px-4 py-3 rounded-lg">
                    <i data-lucide="spray-can" class="h-5 w-5"></i><span class="ml-3">Cleaners</span>
                </a>
                <a data-page="feedback" class="nav-link flex items-center px-4 py-3 rounded-lg">
                    <i data-lucide="message-square" class="h-5 w-5"></i><span class="ml-3">Feedback</span>
                </a>
            </nav>
        </aside>

        <!-- Main content -->
        <div class="flex flex-col flex-1 overflow-y-auto">
            <header class="sticky top-0 z-10 flex items-center justify-between h-20 px-6 header">
                <div>
                    <h1 id="header-title" class="text-2xl font-semibold text-gray-800">Hi, Admin</h1>
                    <p class="text-sm text-gray-600">Welcome to your dashboard</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <i data-lucide="bell" class="h-6 w-6 text-gray-600 cursor-pointer"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge">3</span>
                    </div>
                    <div class="flex items-center space-x-2 cursor-pointer">
                        <div class="h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i data-lucide="user" class="h-5 w-5 text-blue-600"></i>
                        </div>
                        <span class="text-gray-700 font-medium">Admin</span>
                    </div>
                </div>
            </header>

            <main class="p-6 md:p-10 flex-1">
    
                <!-- Dashboard Page Content -->
                <div id="dashboard-page" class="page-content">
                    <div class="content-panel p-6 rounded-lg">
                        <!-- Stats Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card p-6 rounded-lg flex items-center justify-between hover-lift smooth-transition">
                                <div>
                                    <p class="text-sm font-medium opacity-90">Total Bookings</p>
                                    <p class="text-3xl font-bold" id="total-bookings">0</p>
                                </div>
                                <div class="bg-white bg-opacity-20 p-3 rounded-full"><i data-lucide="calendar-check" class="text-white h-6 w-6"></i></div>
                            </div>
                            <div class="stat-card p-6 rounded-lg flex items-center justify-between hover-lift smooth-transition">
                                <div>
                                    <p class="text-sm font-medium opacity-90">Pending Jobs</p>
                                    <p class="text-3xl font-bold" id="pending-jobs">0</p>
                                </div>
                                <div class="bg-white bg-opacity-20 p-3 rounded-full"><i data-lucide="clock" class="text-white h-6 w-6"></i></div>
                            </div>
                            <div class="stat-card p-6 rounded-lg flex items-center justify-between hover-lift smooth-transition">
                                <div>
                                    <p class="text-sm font-medium opacity-90">Active Cleaners</p>
                                    <p class="text-3xl font-bold" id="active-cleaners">0</p>
                                </div>
                                <div class="bg-white bg-opacity-20 p-3 rounded-full"><i data-lucide="users" class="text-white h-6 w-6"></i></div>
                            </div>
                            <div class="stat-card p-6 rounded-lg flex items-center justify-between hover-lift smooth-transition">
                                <div>
                                    <p class="text-sm font-medium opacity-90">New Feedback</p>
                                    <p class="text-3xl font-bold" id="new-feedback">0</p>
                                </div>
                                <div class="bg-white bg-opacity-20 p-3 rounded-full"><i data-lucide="message-square" class="text-white h-6 w-6"></i></div>
                            </div>
                        </div>
        
                        <!-- Recent Bookings Table -->
                        <div>
                            <h3 class="text-xl font-bold mb-4 text-gray-700">Recent Bookings</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead class="table-header">
                                        <tr class="text-sm font-semibold">
                                            <th class="p-4 rounded-l-lg">Customer</th>
                                            <th class="p-4">Date</th>
                                            <th class="p-4">Cleaner</th>
                                            <th class="p-4 rounded-r-lg">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-bookings-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Page Content -->
                <div id="users-page" class="page-content hidden">
                    <div class="content-panel p-6 rounded-lg mb-8">
                        <h3 class="text-xl font-bold mb-4 text-gray-700">Add New User</h3>
                        <form id="add-user-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-3xl">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                                <input type="text" id="name" name="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email ID</label>
                                <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label for="gender" class="block text-sm font-medium text-gray-700">Gender</label>
                                <select id="gender" name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                                    <option value="" disabled selected>Select Gender</option>
                                    <option>Female</option>
                                    <option>Male</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div>
                                <label for="programme" class="block text-sm font-medium text-gray-700">Programme</label>
                                <select id="programme" name="programme" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                                    <option value="" disabled selected>Select Programme</option>
                                    <option>Computer System and Network</option>
                                    <option>Power Engineering</option>
                                    <option>Electronics and Communication</option>
                                    <option>Instrumentation and Control</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 font-semibold flex items-center justify-center mt-4 transition duration-300 hover-lift">
                                    <i data-lucide="plus" class="h-5 w-5 mr-2"></i>Add User
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="content-panel p-6 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-700">Current Users</h3>
                            <button id="import-users-btn" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 font-semibold flex items-center transition duration-300 hover-lift">
                                <i data-lucide="upload" class="h-5 w-5 mr-2"></i>Import Users
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="table-header">
                                    <tr class="text-sm font-semibold">
                                        <th class="p-4">Name</th>
                                        <th class="p-4">Email</th>
                                        <th class="p-4">Programme</th>
                                        <th class="p-4 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body" class="divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                 <!-- Bookings Page Content -->
                <div id="bookings-page" class="page-content hidden">
                    <div class="content-panel p-6 rounded-lg">
                        <div class="flex border-b border-gray-200">
                            <button id="current-bookings-tab" class="booking-tab py-2 px-4 font-semibold border-b-2 active">Current Bookings</button>
                            <button id="history-bookings-tab" class="booking-tab py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent hover:text-gray-700 hover:border-gray-300">Booking History</button>
                        </div>
                        <div class="mt-4">
                            <h3 id="booking-table-title" class="text-xl font-bold text-gray-700 mb-4">Current Bookings</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead class="table-header">
                                        <tr class="text-sm font-semibold">
                                            <th class="p-4">Room</th>
                                            <th class="p-4">Date</th>
                                            <th class="p-4">Time</th>
                                            <th class="p-4">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bookings-table-body" class="divide-y divide-gray-200"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                 <!-- Payments Page Content -->
                <div id="payments-page" class="page-content hidden">
                    <div class="content-panel p-6 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-700">Payment Details</h3>
                            <div class="relative">
                                <input type="text" id="payment-search-input" placeholder="Search by date..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-64">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i data-lucide="search" class="h-5 w-5 text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                        <div id="payments-list" class="space-y-4">
                            <!-- Payment items will be inserted here by JavaScript -->
                        </div>
                    </div>
                </div>

                 <!-- Cleaners Page Content -->
                 <div id="cleaners-page" class="page-content hidden">
                    <div class="content-panel p-6 rounded-lg">
                        <h3 class="text-xl font-bold text-gray-700 mb-4">Cleaner Details</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="table-header">
                                    <tr class="text-sm font-semibold">
                                        <th class="p-4">Name</th>
                                        <th class="p-4">User Id</th>
                                        <th class="p-4">No of Room Cleaned</th>
                                        <th class="p-4 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="cleaners-table-body" class="divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Feedback Page Content -->
                <div id="feedback-page" class="page-content hidden">
                    <div class="content-panel p-6 rounded-lg">
                        <h3 class="text-xl font-bold text-gray-700 mb-4">Service Feedback</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="table-header">
                                    <tr class="text-sm font-semibold">
                                        <th class="p-4">Date</th>
                                        <th class="p-4">Rating</th>
                                        <th class="p-4">Comment</th>
                                    </tr>
                                </thead>
                                <tbody id="feedback-table-body" class="divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <h3 class="text-lg font-bold text-gray-800">Confirm Deletion</h3>
            <p id="delete-modal-text" class="text-gray-600 mt-2">Are you sure you want to delete this item? This action cannot be undone.</p>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition duration-300">Cancel</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition duration-300">Delete</button>
            </div>
        </div>
    </div>

    <!-- Import Users Modal -->
    <div id="import-modal" class="fixed inset-0 import-modal flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Import Users from Database</h3>
            <div class="mb-6">
                <p class="text-gray-600">Select how many users you want to import:</p>
                <div class="flex items-center mt-2">
                    <input type="range" id="user-count-slider" min="1" max="20" value="5" class="w-full">
                    <span id="user-count-display" class="ml-4 text-blue-600 font-semibold">5</span>
                </div>
            </div>
            <div class="mb-6">
                <p class="text-gray-600">Select programme filter:</p>
                <div class="mt-2 grid grid-cols-2 gap-2">
                    <label class="flex items-center">
                        <input type="checkbox" class="programme-filter" value="Computer System and Network" checked>
                        <span class="ml-2 text-sm">Computer Systems</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="programme-filter" value="Power Engineering" checked>
                        <span class="ml-2 text-sm">Power Engineering</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="programme-filter" value="Electronics and Communication" checked>
                        <span class="ml-2 text-sm">Electronics</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="programme-filter" value="Instrumentation and Control" checked>
                        <span class="ml-2 text-sm">Instrumentation</span>
                    </label>
                </div>
            </div>
            <div class="flex justify-end space-x-4">
                <button id="cancel-import-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition duration-300">Cancel</button>
                <button id="confirm-import-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300">Import Users</button>
            </div>
        </div>
    </div>

    <!-- Import Success Notification -->
    <div id="import-success" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <div class="flex items-center">
            <i data-lucide="check-circle" class="h-5 w-5 mr-2"></i>
            <span id="import-success-message">Users imported successfully!</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- MOCK DATA ---
            const mockData = {
                bookings: [
                    { id: 1, customer: 'Sonam Wangmo', date: '26 May', cleaner: 'Tashi Namgay', status: 'Completed', room: 'DA-2-6', time: '8:30 AM'},
                    { id: 2, customer: 'Pema Dorji', date: '26 May', cleaner: 'Dechen Tshomo', status: 'Assigned', room: 'JD-3-4', time: '9:30 AM'},
                    { id: 3, customer: 'Karma Lhamo', date: '26 May', cleaner: 'Ugyen Wangchuk', status: 'Pending', room: 'NB-2-14', time: '2:30 PM'},
                    { id: 4, customer: 'Jigme Singye', date: '27 May', cleaner: 'Tashi Namgay', status: 'Pending', room: 'DA-1-12', time: '10:00 AM' },
                    { id: 5, customer: 'Dechen Yangzom', date: '25 May', cleaner: 'Dechen Tshomo', status: 'Completed', room: 'DA-3-1', time: '11:00 AM' },
                    { id: 6, customer: 'Ugyen Dorji', date: '24 May', cleaner: 'Ugyen Wangchuk', status: 'Completed', room: 'JD-1-5', time: '04:00 PM' },
                ],
                cleaners: [
                    { id: 1, name: 'Tashi', email: 'tashi@gmail.com', roomsCleaned: 7 },
                    { id: 2, name: 'Karma', email: 'karma@gmail.com', roomsCleaned: 5 },
                    { id: 3, name: 'Tenzin', email: 'tenzin@gmail.com', roomsCleaned: 8 },
                    { id: 4, name: 'Norbu', email: 'norbu@gmail.com', roomsCleaned: 2 },
                    { id: 5, name: 'Pema', email: 'pema@gmail.com', roomsCleaned: 9 },
                ],
                feedback: [
                    { id: 1, date: '29 May 2025', rating: 3, comment: 'Good job, Very neat', isNew: true },
                    { id: 2, date: '25 May 2025', rating: 1, comment: 'Missed the Corners a bit', isNew: true },
                    { id: 3, date: '22 May 2025', rating: 5, comment: 'Excellent service!', isNew: false }
                ],
                users: [
                    { id: 1, name: 'Karma Wangmo', email: '0524.jnec@rub.edu.bt', programme: 'Computer System and Network' },
                    { id: 2, name: 'Tenzin Pelden', email: '0523.jnec@rub.edu.bt', programme: 'Power Engineering' },
                    { id: 3, name: 'Jigme Dorji', email: '0821.jnec@rub.edu.bt', programme: 'Electronics and Communication' },
                ],
                payments: [
                    { id: 1, user: 'Sonam Wangmo', date: '26 May, 2025', amount: 'Nu. 90.00', transactionId: 'BOB-1029384', receiptUrl: 'https://placehold.co/300x500/4FD1C5/FFFFFF?text=Receipt+1' },
                    { id: 2, user: 'Pema Dorji', date: '26 May, 2025', amount: 'Nu. 90.00', transactionId: 'BNB-TRN-98765', receiptUrl: 'https://placehold.co/300x500/4FD1C5/FFFFFF?text=Receipt+2' },
                    { id: 3, user: 'Dechen Yangzom', date: '25 May, 2025', amount: 'Nu. 90.00', transactionId: 'BOB-1029301', receiptUrl: 'https://placehold.co/300x500/4FD1C5/FFFFFF?text=Receipt+3' },
                    { id: 4, user: 'Ugyen Dorji', date: '24 May, 2025', amount: 'Nu. 90.00', transactionId: 'BNB-TRN-98755', receiptUrl: 'https://placehold.co/300x500/4FD1C5/FFFFFF?text=Receipt+4' },
                ],
                // Database users for import simulation
                databaseUsers: [
                    { id: 101, name: 'Dorji Wangchuk', email: '0421.jnec@rub.edu.bt', programme: 'Computer System and Network' },
                    { id: 102, name: 'Pema Lhamo', email: '0622.jnec@rub.edu.bt', programme: 'Power Engineering' },
                    { id: 103, name: 'Karma Tshering', email: '0723.jnec@rub.edu.bt', programme: 'Electronics and Communication' },
                    { id: 104, name: 'Sonam Dema', email: '0824.jnec@rub.edu.bt', programme: 'Instrumentation and Control' },
                    { id: 105, name: 'Tashi Yangchen', email: '0925.jnec@rub.edu.bt', programme: 'Computer System and Network' },
                    { id: 106, name: 'Ugyen Phuntsho', email: '1026.jnec@rub.edu.bt', programme: 'Power Engineering' },
                    { id: 107, name: 'Dechen Zangmo', email: '1127.jnec@rub.edu.bt', programme: 'Electronics and Communication' },
                    { id: 108, name: 'Lhamo Dolma', email: '1228.jnec@rub.edu.bt', programme: 'Instrumentation and Control' },
                    { id: 109, name: 'Kinzang Dorji', email: '1329.jnec@rub.edu.bt', programme: 'Computer System and Network' },
                    { id: 110, name: 'Pelden Wangmo', email: '1430.jnec@rub.edu.bt', programme: 'Power Engineering' },
                    { id: 111, name: 'Nima Gyeltshen', email: '1531.jnec@rub.edu.bt', programme: 'Electronics and Communication' },
                    { id: 112, name: 'Sangay Choden', email: '1632.jnec@rub.edu.bt', programme: 'Instrumentation and Control' },
                    { id: 113, name: 'Tenzin Lhamo', email: '1733.jnec@rub.edu.bt', programme: 'Computer System and Network' },
                    { id: 114, name: 'Jigme Dema', email: '1834.jnec@rub.edu.bt', programme: 'Power Engineering' },
                    { id: 115, name: 'Karma Dorji', email: '1935.jnec@rub.edu.bt', programme: 'Electronics and Communication' },
                    { id: 116, name: 'Sonam Wangdi', email: '2036.jnec@rub.edu.bt', programme: 'Instrumentation and Control' },
                    { id: 117, name: 'Pema Tshering', email: '2137.jnec@rub.edu.bt', programme: 'Computer System and Network' },
                    { id: 118, name: 'Dechen Wangmo', email: '2238.jnec@rub.edu.bt', programme: 'Power Engineering' },
                    { id: 119, name: 'Ugyen Lhamo', email: '2339.jnec@rub.edu.bt', programme: 'Electronics and Communication' },
                    { id: 120, name: 'Tashi Dema', email: '2440.jnec@rub.edu.bt', programme: 'Instrumentation and Control' },
                ]
            };

            // --- DOM Elements ---
            const mainContent = document.querySelector('main');
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-content');
            const headerTitle = document.getElementById('header-title');
            const deleteModal = document.getElementById('delete-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const importModal = document.getElementById('import-modal');
            const importUsersBtn = document.getElementById('import-users-btn');
            const cancelImportBtn = document.getElementById('cancel-import-btn');
            const confirmImportBtn = document.getElementById('confirm-import-btn');
            const userCountSlider = document.getElementById('user-count-slider');
            const userCountDisplay = document.getElementById('user-count-display');
            const importSuccess = document.getElementById('import-success');
            const importSuccessMessage = document.getElementById('import-success-message');
            const currentBookingsTab = document.getElementById('current-bookings-tab');
            const historyBookingsTab = document.getElementById('history-bookings-tab');
            const bookingTableTitle = document.getElementById('booking-table-title');
            const paymentSearchInput = document.getElementById('payment-search-input');
            let itemToDelete = { id: null, type: null };
            let activeBookingTab = 'current';
            let currentPage = 'dashboard';

            // --- History API Implementation ---
            const updateHistory = (pageId) => {
                if (history.state?.page !== pageId) {
                    history.pushState({ page: pageId }, '', `#${pageId}`);
                }
            };

            const handlePopState = (event) => {
                const pageId = event.state?.page || 'dashboard';
                showPage(pageId, false); // Don't update history when handling popstate
            };

            const handleInitialPageLoad = () => {
                let pageId = 'dashboard';
                
                // Check if there's a hash in the URL
                if (window.location.hash) {
                    pageId = window.location.hash.substring(1); // Remove the # character
                }
                
                // Verify the pageId is valid
                if (!pageConfig[pageId]) {
                    pageId = 'dashboard';
                }
                
                // Update history and show the page
                updateHistory(pageId);
                showPage(pageId, false);
            };

            // --- Page Content Render Functions ---
            const renderDashboard = () => {
                document.getElementById('total-bookings').textContent = mockData.bookings.length;
                document.getElementById('pending-jobs').textContent = mockData.bookings.filter(b => b.status === 'Pending' || b.status === 'Assigned').length;
                document.getElementById('active-cleaners').textContent = mockData.cleaners.length;
                document.getElementById('new-feedback').textContent = mockData.feedback.filter(f => f.isNew).length;

                const createStatusBadge = (status) => {
                    const colors = { 'Completed': 'text-green-800 bg-green-200', 'Pending': 'text-yellow-800 bg-yellow-200', 'In Progress': 'text-blue-800 bg-blue-200', 'Assigned': 'text-blue-800 bg-blue-200' };
                    return `<span class="px-2 py-1 text-xs font-semibold ${colors[status] || 'text-gray-800 bg-gray-200'} rounded-full">${status}</span>`;
                };
                const bookingsBody = document.getElementById('recent-bookings-body');
                bookingsBody.innerHTML = mockData.bookings.slice(0, 5).map(b => `
                    <tr class="table-row border-b border-gray-200 last:border-b-0">
                        <td class="p-4 font-medium">${b.customer}</td>
                        <td class="p-4">${b.date}</td>
                        <td class="p-4">${b.cleaner}</td>
                        <td class="p-4">${createStatusBadge(b.status)}</td>
                    </tr>`).join('');
            };

            const renderUsers = () => {
                const usersTableBody = document.getElementById('users-table-body');
                usersTableBody.innerHTML = mockData.users.map(user => `
                    <tr class="table-row hover:bg-gray-50">
                        <td class="p-4 font-medium text-gray-900">${user.name}</td>
                        <td class="p-4 text-gray-600">${user.email}</td>
                        <td class="p-4 text-gray-600">${user.programme}</td>
                        <td class="p-4 text-right space-x-2">
                            <button class="p-2 text-blue-600 hover:bg-blue-100 rounded-full transition duration-300" title="Edit">
                                <i data-lucide="edit" class="h-5 w-5"></i>
                            </button>
                            <button class="delete-btn p-2 text-red-600 hover:bg-red-100 rounded-full transition duration-300" title="Delete" data-id="${user.id}">
                                <i data-lucide="trash-2" class="h-5 w-5"></i>
                            </button>
                        </td>
                    </tr>`).join('');
            };
            
            const renderCleaners = () => {
                const cleanersTableBody = document.getElementById('cleaners-table-body');
                cleanersTableBody.innerHTML = mockData.cleaners.map(cleaner => `
                    <tr class="table-row hover:bg-gray-50">
                        <td class="p-4 font-medium text-gray-900">${cleaner.name}</td>
                        <td class="p-4 text-gray-600">${cleaner.email}</td>
                        <td class="p-4 text-gray-600">${cleaner.roomsCleaned}</td>
                        <td class="p-4 text-right">
                            <button class="delete-cleaner-btn p-2 text-red-600 hover:bg-red-100 rounded-full transition duration-300" title="Delete" data-id="${cleaner.id}">
                                <i data-lucide="trash-2" class="h-5 w-5"></i>
                            </button>
                        </td>
                    </tr>`).join('');
            };

            const renderBookings = () => {
                const bookingsTableBody = document.getElementById('bookings-table-body');
                const createBookingStatusBadge = (status) => {
                    const colors = { 'Completed': 'text-purple-800 bg-purple-200', 'Pending': 'text-red-800 bg-red-200', 'Assigned': 'text-blue-800 bg-blue-200' };
                    return `<span class="px-3 py-1 text-xs font-semibold ${colors[status] || 'text-gray-800 bg-gray-200'} rounded-full">${status}</span>`;
                };

                if (activeBookingTab === 'current') {
                    currentBookingsTab.classList.add('active');
                    historyBookingsTab.classList.remove('active');
                    bookingTableTitle.textContent = 'Current Bookings';
                } else {
                    historyBookingsTab.classList.add('active');
                    currentBookingsTab.classList.remove('active');
                    bookingTableTitle.textContent = 'Booking History';
                }

                const bookingsToRender = activeBookingTab === 'current'
                    ? mockData.bookings.filter(b => b.status !== 'Completed')
                    : mockData.bookings.filter(b => b.status === 'Completed');

                bookingsTableBody.innerHTML = bookingsToRender.map(booking => `
                    <tr class="table-row hover:bg-gray-50">
                        <td class="p-4 font-medium text-gray-900">${booking.room}</td>
                        <td class="p-4 text-gray-600">${booking.date}</td>
                        <td class="p-4 text-gray-600">${booking.time}</td>
                        <td class="p-4">${createBookingStatusBadge(booking.status)}</td>
                    </tr>
                `).join('');
                lucide.createIcons();
            };

            const renderPayments = (searchTerm = '') => {
                const paymentsList = document.getElementById('payments-list');
                const lowercasedSearchTerm = searchTerm.toLowerCase();
                
                const filteredPayments = mockData.payments.filter(payment => 
                    payment.date.toLowerCase().includes(lowercasedSearchTerm)
                );

                if (filteredPayments.length === 0) {
                    paymentsList.innerHTML = `<p class="text-gray-500 text-center py-8">No payments found.</p>`;
                    return;
                }

                paymentsList.innerHTML = filteredPayments.map(payment => `
                    <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-300 hover-lift">
                        <div class="flex-shrink-0 mr-4">
                            <i data-lucide="user-circle" class="h-10 w-10 text-gray-400"></i>
                        </div>
                        <div class="flex-grow">
                            <p class="font-bold text-gray-800">${payment.user}</p>
                            <p class="text-sm text-gray-500">${payment.date} - ${payment.amount}</p>
                            <p class="text-xs text-gray-400 font-mono">${payment.transactionId}</p>
                        </div>
                        <div class="flex-shrink-0">
                            <img src="${payment.receiptUrl}" alt="Receipt for ${payment.user}" class="h-20 w-auto rounded-md cursor-pointer hover:scale-105 transition-transform receipt-thumbnail">
                        </div>
                    </div>
                `).join('');
                lucide.createIcons();
            };

            const renderFeedback = () => {
                const feedbackTableBody = document.getElementById('feedback-table-body');
                
                const createStarRating = (rating) => {
                    let stars = '';
                    for (let i = 1; i <= 5; i++) {
                        stars += `<i data-lucide="star" class="h-5 w-5 ${i <= rating ? 'text-yellow-400 fill-current' : 'text-gray-300'}"></i>`;
                    }
                    return `<div class="flex">${stars}</div>`;
                };

                feedbackTableBody.innerHTML = mockData.feedback.map(item => `
                    <tr class="table-row hover:bg-gray-50">
                        <td class="p-4 text-gray-600">${item.date}</td>
                        <td class="p-4">${createStarRating(item.rating)}</td>
                        <td class="p-4 text-gray-600">${item.comment}</td>
                    </tr>
                `).join('');
                lucide.createIcons();
            };

            // --- Page Switching Logic ---
            const pageConfig = {
                dashboard: { title: 'Hi, Admin', render: renderDashboard },
                users: { title: 'Manage Users', render: renderUsers },
                bookings: { title: 'Booking Details', render: () => { activeBookingTab = 'current'; renderBookings(); } },
                payments: { title: 'Payment Details', render: () => renderPayments() },
                cleaners: { title: 'Cleaner Details', render: renderCleaners },
                feedback: { title: 'Service Feedback', render: renderFeedback },
            };

            const showPage = (pageId, updateHistoryFlag = true) => {
                // Don't do anything if we're already on this page
                if (currentPage === pageId) return;
                
                // Update browser history if needed
                if (updateHistoryFlag) {
                    updateHistory(pageId);
                }
                
                pages.forEach(page => page.classList.add('hidden'));
                const activePage = document.getElementById(`${pageId}-page`);
                if (activePage) {
                    activePage.classList.remove('hidden');
                    headerTitle.textContent = pageConfig[pageId].title;
                    if(pageId === 'payments') { paymentSearchInput.value = ''; }
                    pageConfig[pageId].render();
                }

                navLinks.forEach(link => link.classList.toggle('active', link.dataset.page === pageId));
                lucide.createIcons();
                
                // Update current page
                currentPage = pageId;
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage(e.currentTarget.dataset.page);
                });
            });

            // --- Import Users Functionality ---
            importUsersBtn.addEventListener('click', () => {
                importModal.classList.remove('hidden');
            });

            cancelImportBtn.addEventListener('click', () => {
                importModal.classList.add('hidden');
            });

            userCountSlider.addEventListener('input', () => {
                userCountDisplay.textContent = userCountSlider.value;
            });

            confirmImportBtn.addEventListener('click', () => {
                const userCount = parseInt(userCountSlider.value);
                const selectedProgrammes = Array.from(document.querySelectorAll('.programme-filter:checked'))
                    .map(checkbox => checkbox.value);
                
                // Filter database users by selected programmes
                const filteredUsers = mockData.databaseUsers.filter(user => 
                    selectedProgrammes.includes(user.programme)
                );
                
                // Get random users from filtered list
                const usersToImport = [];
                const availableUsers = [...filteredUsers];
                
                for (let i = 0; i < Math.min(userCount, availableUsers.length); i++) {
                    const randomIndex = Math.floor(Math.random() * availableUsers.length);
                    usersToImport.push(availableUsers[randomIndex]);
                    availableUsers.splice(randomIndex, 1);
                }
                
                // Add imported users to the current users list
                mockData.users.push(...usersToImport);
                
                // Re-render users table
                renderUsers();
                
                // Close modal and show success message
                importModal.classList.add('hidden');
                importSuccessMessage.textContent = `${usersToImport.length} users imported successfully!`;
                importSuccess.classList.remove('hidden');
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    importSuccess.classList.add('hidden');
                }, 3000);
                
                lucide.createIcons();
            });

            // --- Event Listeners ---
            const addUserForm = document.getElementById('add-user-form');
            addUserForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newUser = {
                    id: Date.now(),
                    name: e.target.name.value, 
                    email: e.target.email.value, 
                    programme: e.target.programme.value
                };
                mockData.users.unshift(newUser);
                renderUsers();
                addUserForm.reset();
                lucide.createIcons();
            });
            
            mainContent.addEventListener('click', (e) => {
                const deleteUserBtn = e.target.closest('.delete-btn');
                if (deleteUserBtn) {
                    itemToDelete = { id: parseInt(deleteUserBtn.dataset.id), type: 'user' };
                    document.getElementById('delete-modal-text').textContent = 'Are you sure you want to delete this user? This action cannot be undone.';
                    deleteModal.classList.remove('hidden');
                    return;
                }
                
                const deleteCleanerBtn = e.target.closest('.delete-cleaner-btn');
                if (deleteCleanerBtn) {
                    itemToDelete = { id: parseInt(deleteCleanerBtn.dataset.id), type: 'cleaner' };
                    document.getElementById('delete-modal-text').textContent = 'Are you sure you want to delete this cleaner? This action cannot be undone.';
                    deleteModal.classList.remove('hidden');
                    return;
                }
            });

            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.classList.add('hidden');
                itemToDelete = { id: null, type: null };
            });

            confirmDeleteBtn.addEventListener('click', () => {
                if (itemToDelete.id !== null) {
                    if (itemToDelete.type === 'user') {
                        mockData.users = mockData.users.filter(item => item.id !== itemToDelete.id);
                        renderUsers();
                    } else if (itemToDelete.type === 'cleaner') {
                        mockData.cleaners = mockData.cleaners.filter(item => item.id !== itemToDelete.id);
                        renderCleaners();
                    }
                    
                    lucide.createIcons();
                    deleteModal.classList.add('hidden');
                    itemToDelete = { id: null, type: null };
                }
            });

            currentBookingsTab.addEventListener('click', () => {
                activeBookingTab = 'current';
                renderBookings();
            });
            historyBookingsTab.addEventListener('click', () => {
                activeBookingTab = 'history';
                renderBookings();
            });

            paymentSearchInput.addEventListener('input', (e) => {
                renderPayments(e.target.value);
            });

            // --- Set up browser history event listener ---
            window.addEventListener('popstate', handlePopState);

            // --- Initial Load ---
            handleInitialPageLoad();
        });
    </script>
</body>
</html>